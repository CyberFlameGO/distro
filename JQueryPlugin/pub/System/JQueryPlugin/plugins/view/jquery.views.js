(function(factory,global){var $=global.jQuery;if(typeof exports==="object"){module.exports=$?factory(global,$):function($){return factory(global,$)}}else if(typeof define==="function"&&define.amd){define(["jquery","./jsrender","./jquery.observable"],function($,jsr,jso){return factory(global,$,jsr,jso)})}else{factory(global,false)}})(function(global,$,jsr,jso){"use strict";var setGlobals=$===false;jsr=jsr||setGlobals&&global.jsrender;$=$||global.jQuery;var versionNumber="v0.9.83",requiresStr="JsViews requires ";if(!$||!$.fn){throw requiresStr+"jQuery"}if(jsr&&!jsr.fn){jsr.views.sub._jq($)}var $observe,$observable,$isArray=$.isArray,$views=$.views;if(!$views||!$views.map){throw requiresStr+"JsRender"}var document=global.document,$viewsSettings=$views.settings,$sub=$views.sub,$subSettings=$sub.settings,$extend=$sub.extend,$isFunction=$.isFunction,$expando=$.expando,$converters=$views.converters,$tags=$views.tags,$subSettingsAdvanced=$subSettings.advanced,propertyChangeStr=$sub.propChng=$sub.propChng||"propertyChange",arrayChangeStr=$sub.arrChng=$sub.arrChng||"arrayChange",HTML="html",syntaxError=$sub.syntaxErr,rFirstElem=/<(?!script)(\w+)[>\s]/,error=$sub._er,onRenderError=$sub._err,delimOpenChar0,delimOpenChar1,delimCloseChar0,delimCloseChar1,linkChar,topView,rEscapeQuotes=/['"\\]/g;if($.link){return $}$subSettings.trigger=true;var activeBody,rTagDatalink,$view,$viewsLinkAttr,linkViewsSel,wrapMap,viewStore,oldAdvSet,jsvAttrStr="data-jsv",elementChangeStr="change.jsv",onBeforeChangeStr="onBeforeChange",onAfterChangeStr="onAfterChange",onAfterCreateStr="onAfterCreate",CHECKED="checked",CHECKBOX="checkbox",RADIO="radio",NONE="none",SCRIPT="SCRIPT",TRUE="true",closeScript='"></script>',openScript='<script type="jsv',deferAttr=jsvAttrStr+"-df",bindElsSel="script,["+jsvAttrStr+"]",fnSetters={value:"val",input:"val",html:HTML,text:"text"},valueBinding={from:"value",to:"value"},isCleanCall=0,oldCleanData=$.cleanData,oldJsvDelimiters=$viewsSettings.delimiters,safeFragment=document.createDocumentFragment(),qsa=document.querySelector,elContent={ol:1,ul:1,table:1,tbody:1,thead:1,tfoot:1,tr:1,colgroup:1,dl:1,select:1,optgroup:1,svg:1,svg_ns:1},badParent={tr:"table"},voidElems={br:1,img:1,input:1,hr:1,area:1,base:1,col:1,link:1,meta:1,command:1,embed:1,keygen:1,param:1,source:1,track:1,wbr:1},displayStyles={},bindingStore={},bindingKey=1,rViewPath=/^#(view\.?)?/,rConvertMarkers=/((\/>)|<\/(\w+)>|)(\s*)([#\/]\d+(?:_|(\^)))`(\s*)(<\w+(?=[\s\/>]))?|\s*(?:(<\w+(?=[\s\/>]))|<\/(\w+)>(\s*)|(\/>)\s*|(>)|$)/g,rOpenViewMarkers=/(#)()(\d+)(_)/g,rOpenMarkers=/(#)()(\d+)([_^])/g,rViewMarkers=/(?:(#)|(\/))(\d+)(_)/g,rOpenTagMarkers=/(#)()(\d+)(\^)/g,rMarkerTokens=/(?:(#)|(\/))(\d+)([_^])([-+@\d]+)?/g,rSplitBindings=/&(\d+)\+?/g,getComputedStyle=global.getComputedStyle;$observable=$.observable;if(!$observable){throw requiresStr+"JsObservable"}$observe=$observable.observe;function elemChangeHandler(ev,params,sourceValue){var setter,cancel,fromAttr,linkCtx,cvtBack,cnvtName,target,$source,view,binding,oldLinkCtx,onBeforeChange,onAfterChange,tag,to,eventArgs,exprOb,contextCb,source=ev.target,bindings=source._jsvBnd;while(binding=rSplitBindings.exec(bindings)){if(binding=bindingStore[binding[1]]){if(to=binding.to){linkCtx=binding.linkCtx;view=linkCtx.view;tag=linkCtx.tag||view.tag;$source=$(source);onBeforeChange=view.hlp(onBeforeChangeStr);onAfterChange=view.hlp(onAfterChangeStr);fromAttr=defaultAttr(source);setter=fnSetters[fromAttr];if(sourceValue===undefined){sourceValue=$isFunction(fromAttr)?fromAttr(source):setter?$source[setter]():$source.attr(fromAttr)}cnvtName=to[1];to=to[0];to=to+""===to?[linkCtx.data,to]:to;if(cnvtName){if($isFunction(cnvtName)){cvtBack=cnvtName}else{cvtBack=view.getRsc("converters",cnvtName)}}if(linkCtx.elem.nodeName==="SELECT"){linkCtx.elem._jsvSel=sourceValue=sourceValue||(linkCtx.elem.multiple?[]:sourceValue)}if(cvtBack){sourceValue=cvtBack.call(tag,sourceValue)}oldLinkCtx=view.linkCtx;view.linkCtx=linkCtx;eventArgs={change:"change",oldValue:linkCtx._val,value:sourceValue};if((!onBeforeChange||!(cancel=onBeforeChange.call(linkCtx,ev,eventArgs)===false))&&(!tag||!tag.onBeforeChange||!(cancel=tag.onBeforeChange(ev,eventArgs)===false))&&sourceValue!==undefined){target=to[0];if(sourceValue!==undefined&&target){if(target._jsv){contextCb=linkCtx._ctxCb;exprOb=target;target=linkCtx.data;if(exprOb._cpCtx){target=exprOb.data;contextCb=exprOb._cpCtx}while(exprOb&&exprOb.sb){target=contextCb(exprOb,target);exprOb=exprOb.sb}}if(tag){tag._.chging=true}$observable(target).setProperty(to[1],sourceValue);if(onAfterChange){onAfterChange.call(linkCtx,ev,eventArgs)}if(tag){if(tag.onAfterChange){tag.onAfterChange(ev,eventArgs)}tag._.chging=undefined}linkCtx._val=sourceValue}}view.linkCtx=oldLinkCtx}}}}function propertyChangeHandler(ev,eventArgs,linkFn){var attr,sourceValue,noUpdate,forceUpdate,hasError,onError,linkCtx=this,tag=linkCtx.tag,source=linkCtx.data,target=linkCtx.elem,cvt=linkCtx.convert,parentElem=target.parentNode,view=linkCtx.view,oldLinkCtx=view.linkCtx,onEvent=view.hlp(onBeforeChangeStr);view.linkCtx=linkCtx;if(parentElem&&(!onEvent||!(eventArgs&&onEvent.call(linkCtx,ev,eventArgs)===false))&&!(eventArgs&&ev.data.prop!=="*"&&ev.data.prop!==eventArgs.path)){if(eventArgs){linkCtx.eventArgs=eventArgs}if(eventArgs||linkCtx._toLk){linkCtx._toLk=0;if(linkFn._er){try{sourceValue=linkFn(source,view)}catch(e){hasError=linkFn._er;onError=onRenderError(e,view,new Function("data,view","return "+hasError+";")(source,view));sourceValue=[{props:{},args:[onError]}]}}else{sourceValue=linkFn(source,view,$sub)}attr=getTargetVal(sourceValue,linkCtx,tag=linkCtx.tag,linkCtx.attr||defaultAttr(target,true,cvt!==undefined));if(tag){forceUpdate=hasError||tag._er;sourceValue=sourceValue[0]?sourceValue:[sourceValue];noUpdate=!forceUpdate&&eventArgs&&tag.onUpdate&&tag.onUpdate(ev,eventArgs,sourceValue)===false;mergeCtxs(tag,sourceValue,forceUpdate);if(noUpdate||attr===NONE){callAfterLink(tag,ev,eventArgs);observeAndBind(linkCtx,source,target);view.linkCtx=oldLinkCtx;return}if(tag._.chging){return}if(tag.onUnbind){tag.onUnbind(tag.tagCtx,linkCtx,tag.ctx,ev,eventArgs)}sourceValue=tag.tagName===":"?$sub._cnvt(tag.cvt,view,sourceValue[0]):$sub._tag(tag,view,view.tmpl,sourceValue,true,onError)}else if(linkFn._tag){cvt=cvt===""?TRUE:cvt;sourceValue=cvt?$sub._cnvt(cvt,view,sourceValue[0]||sourceValue):$sub._tag(linkFn._tag,view,view.tmpl,sourceValue,true,onError);addLinkMethods(tag=linkCtx.tag,true);attr=linkCtx.attr||attr}if(updateContent(sourceValue,linkCtx,attr,tag)&&eventArgs&&(onEvent=view.hlp(onAfterChangeStr))){onEvent.call(linkCtx,ev,eventArgs)}linkCtx._noUpd=0;if(tag){tag._er=hasError;callAfterLink(tag,ev,eventArgs)}}observeAndBind(linkCtx,source,target);view.linkCtx=oldLinkCtx}}function getTargetVal(sourceValue,linkCtx,tag,attr){var currentValue,setter,css,$target,target=tag&&tag.parentElem||linkCtx.elem;if(sourceValue!==undefined){$target=$(target);attr=tag&&tag.attr||attr;if($isFunction(sourceValue)){error(linkCtx.expr+": missing parens")}if(css=/^css-/.test(attr)&&attr.slice(4)){currentValue=$.style(target,css);if(+sourceValue===sourceValue){currentValue=parseInt(currentValue)}}else if(attr!=="link"){if(attr==="value"){if(target.type===CHECKBOX){currentValue=$target.prop(attr=CHECKED)}}else if(attr===RADIO){if(target.value===""+sourceValue){currentValue=$target.prop(CHECKED)}else{return attr}}if(currentValue===undefined){setter=fnSetters[attr];currentValue=setter?$target[setter]():$target.attr(attr)}}linkCtx._val=currentValue}return attr}function setDefer(elem,value){elem._df=value;elem[(value?"set":"remove")+"Attribute"](deferAttr,"")}function updateContent(sourceValue,linkCtx,attr,tag){var setter,prevNode,nextNode,promise,nodesToRemove,useProp,tokens,id,openIndex,closeIndex,testElem,nodeName,cStyle,jsvSel,renders=attr!==NONE&&sourceValue!==undefined&&!linkCtx._noUpd,source=linkCtx.data,target=tag&&tag.parentElem||linkCtx.elem,targetParent=target.parentNode,$target=$(target),view=linkCtx.view,targetVal=linkCtx._val,oldLinkCtx=view.linkCtx,change=tag;if(tag){tag._.unlinked=true;tag.parentElem=tag.parentElem||(linkCtx.expr||tag._elCnt)?target:targetParent;prevNode=tag._prv;nextNode=tag._nxt}if(!renders){return}if(attr==="visible"){attr="css-display"}if(/^css-/.test(attr)){if(linkCtx.attr==="visible"){cStyle=(target.currentStyle||getComputedStyle.call(global,target,"")).display;if(sourceValue){sourceValue=target._jsvd||cStyle;if(sourceValue===NONE&&!(sourceValue=displayStyles[nodeName=target.nodeName])){testElem=document.createElement(nodeName);document.body.appendChild(testElem);sourceValue=displayStyles[nodeName]=(testElem.currentStyle||getComputedStyle.call(global,testElem,"")).display;document.body.removeChild(testElem)}}else{target._jsvd=cStyle;sourceValue=NONE}}if(change=change||targetVal!==sourceValue){$.style(target,attr.slice(4),sourceValue)}}else if(attr!=="link"){if(/^data-/.test(attr)){$.data(target,attr.slice(5),sourceValue)}if(attr===CHECKED){useProp=true;sourceValue=sourceValue&&sourceValue!=="false"}else if(attr===RADIO){useProp=true;attr=CHECKED;sourceValue=target.value===""+sourceValue}else if(attr==="selected"||attr==="disabled"||attr==="multiple"||attr==="readonly"){sourceValue=sourceValue&&sourceValue!=="false"?attr:null}else if(attr==="value"&&target.nodeName==="SELECT"){target._jsvSel=$isArray(sourceValue)?sourceValue:""+sourceValue}if(setter=fnSetters[attr]){if(attr===HTML){view.linkCtx=linkCtx;if(tag&&tag._.inline){nodesToRemove=tag.nodes(true);if(tag._elCnt){if(prevNode&&prevNode!==nextNode){transferViewTokens(prevNode,nextNode,target,tag._tgId,"^",true)}else if(tokens=target._df){id=tag._tgId+"^";openIndex=tokens.indexOf("#"+id)+1;closeIndex=tokens.indexOf("/"+id);if(openIndex&&closeIndex>0){openIndex+=id.length;if(closeIndex>openIndex){setDefer(target,tokens.slice(0,openIndex)+tokens.slice(closeIndex));disposeTokens(tokens.slice(openIndex,closeIndex))}}}prevNode=prevNode?prevNode.previousSibling:nextNode?nextNode.previousSibling:target.lastChild}$(nodesToRemove).remove();promise=view.link(view.data,target,prevNode,nextNode,sourceValue,tag&&{tag:tag._tgId,lazyLink:tag.tagCtx.props.lazyLink})}else{renders=renders&&targetVal!==sourceValue;if(renders){$target.empty()}if(renders){promise=view.link(source,target,prevNode,nextNode,sourceValue,tag&&{tag:tag._tgId})}}view.linkCtx=oldLinkCtx}else{if(change=change||targetVal!==sourceValue){if(attr==="text"&&target.children&&!target.children[0]){if(target.textContent!==undefined){target.textContent=sourceValue}else{target.innerText=sourceValue===null?"":sourceValue}}else{$target[setter](sourceValue)}}if((jsvSel=targetParent._jsvSel)&&(attr==="value"||!$target.attr("value"))){target.selected=$.inArray(""+sourceValue,$isArray(jsvSel)?jsvSel:[jsvSel])>-1}}}else if(change=change||targetVal!==sourceValue){$target[useProp?"prop":"attr"](attr,sourceValue===undefined&&!useProp?null:sourceValue)}linkCtx._val=sourceValue}return promise||change}function arrayChangeHandler(ev,eventArgs){var self=this,onBeforeChange=self.hlp(onBeforeChangeStr),onAfterChange=self.hlp(onAfterChangeStr);if(!onBeforeChange||onBeforeChange.call(this,ev,eventArgs)!==false){if(eventArgs){var action=eventArgs.change,index=eventArgs.index,items=eventArgs.items;self._.srt=eventArgs.refresh;switch(action){case"insert":self.addViews(index,items);break;case"remove":self.removeViews(index,items.length);break;case"move":self.removeViews(eventArgs.oldIndex,items.length,undefined,true);self.addViews(index,items);break;case"refresh":self._.srt=undefined;self.fixIndex(0)}}if(onAfterChange){onAfterChange.call(this,ev,eventArgs)}}}function setArrayChangeLink(view){var handler,arrayBinding,type=view.type,data=view.data,bound=view._.bnd;if(!view._.useKey&&bound){if(arrayBinding=view._.bndArr){$([arrayBinding[1]]).off(arrayChangeStr,arrayBinding[0]);view._.bndArr=undefined}if(bound!==!!bound){if(type){bound._.arrVws[view._.id]=view}else{delete bound._.arrVws[view._.id]}}else if(type&&data){handler=function(ev){if(!(ev.data&&ev.data.off)){arrayChangeHandler.apply(view,arguments)}};$([data]).on(arrayChangeStr,handler);view._.bndArr=[handler,data]}}}function defaultAttr(elem,to,linkGetVal){var nodeName=elem.nodeName.toLowerCase(),attr=$subSettingsAdvanced._fe[nodeName]||elem.contentEditable===TRUE&&{to:HTML,from:HTML};return attr?to?nodeName==="input"&&elem.type===RADIO?RADIO:attr.to:attr.from:to?linkGetVal?"text":HTML:""}function renderAndLink(view,index,tmpl,views,data,context,refresh){var html,linkToNode,prevView,nodesToRemove,bindId,parentNode=view.parentElem,prevNode=view._prv,nextNode=view._nxt,elCnt=view._elCnt;if(prevNode&&prevNode.parentNode!==parentNode){error("Missing parentNode")}if(refresh){nodesToRemove=view.nodes();if(elCnt&&prevNode&&prevNode!==nextNode){transferViewTokens(prevNode,nextNode,parentNode,view._.id,"_",true)}view.removeViews(undefined,undefined,true);linkToNode=nextNode;if(elCnt){prevNode=prevNode?prevNode.previousSibling:nextNode?nextNode.previousSibling:parentNode.lastChild}$(nodesToRemove).remove();for(bindId in view._.bnds){removeViewBinding(bindId)}}else{if(index){prevView=views[index-1];if(!prevView){return false}prevNode=prevView._nxt}if(elCnt){linkToNode=prevNode;prevNode=linkToNode?linkToNode.previousSibling:parentNode.lastChild}else{linkToNode=prevNode.nextSibling}}html=tmpl.render(data,context,view._.useKey&&refresh,view,refresh||index,true);view.link(data,parentNode,prevNode,linkToNode,html,prevView)}function addBindingMarkers(value,view,tag){var id,end;if(tag){end="^`";addLinkMethods(tag,true);id=tag._tgId;if(!id){bindingStore[id=bindingKey++]=tag;tag._tgId=""+id}}else{end="_`";addLinkMethods(viewStore[id=view._.id]=view)}return"#"+id+end+(value!=undefined?value:"")+"/"+id+end}function observeAndBind(linkCtx,source,target){var binding,l,k,linkedElem,exprFnDeps,exprOb,prop,propDeps,tag=linkCtx.tag,cvtBk=linkCtx.convertBack,depends=[],bindId=linkCtx._bndId||""+bindingKey++,handler=linkCtx._hdl;linkCtx._bndId=undefined;if(tag){depends=tag.depends||depends;depends=$isFunction(depends)?tag.depends(tag):depends;linkedElem=tag.linkedElem}if(!linkCtx._depends||""+linkCtx._depends!==""+depends){if(linkCtx._depends){$observable._apply(false,[source],linkCtx._depends,handler,true)}exprFnDeps=linkCtx.fn.deps.slice();if(tag&&tag.boundProps){l=tag.boundProps.length;while(l--){prop=tag.boundProps[l];k=tag._.bnd.paths.length;while(k--){propDeps=tag._.bnd.paths[k][prop];if(propDeps&&propDeps.skp){exprFnDeps=exprFnDeps.concat(propDeps)}}}}l=exprFnDeps.length;while(l--){exprOb=exprFnDeps[l];if(exprOb._jsv){exprFnDeps[l]=$extend({},exprOb)}}binding=$observable._apply(false,[source],exprFnDeps,depends,handler,linkCtx._ctxCb);binding.elem=target;binding.linkCtx=linkCtx;binding._tgId=bindId;target._jsvBnd=target._jsvBnd||"";target._jsvBnd+="&"+bindId;linkCtx._depends=depends;linkCtx.view._.bnds[bindId]=bindId;bindingStore[bindId]=binding;if(linkedElem){l=linkedElem.length;while(l--){linkedElem[l]._jsvLkEl=tag;bindTo(binding,tag,linkedElem[l]);linkedElem[l]._jsvBnd="&"+binding._tgId+"+"}}else if(cvtBk!==undefined){bindTo(binding,tag,target,cvtBk)}if(tag){if(!tag.flow&&!tag._.inline){target.setAttribute(jsvAttrStr,(target.getAttribute(jsvAttrStr)||"")+"#"+bindId+"^/"+bindId+"^");tag._tgId=""+bindId}}}}function tmplLink(to,from,context,noIteration,parentView,prevNode,nextNode){return $link(this,to,from,context,noIteration,parentView,prevNode,nextNode)}function $link(tmplOrLinkExpr,to,from,context,noIteration,parentView,prevNode,nextNode){if(context===true){noIteration=context;context=undefined}else if(typeof context!=="object"){context=undefined}else{context=$extend({},context)}if(tmplOrLinkExpr&&to){to=to.jquery?to:$(to);if(!activeBody){activeBody=document.body;$(activeBody).on(elementChangeStr,elemChangeHandler).on("blur","[contenteditable]",elemChangeHandler)}var i,k,html,vwInfos,view,placeholderParent,targetEl,refresh,topLevelCall,onRender=addBindingMarkers,replaceMode=context&&context.target==="replace",l=to.length;while(l--){targetEl=to[l];parentView=parentView||$view(targetEl);if(topLevelCall=parentView===topView){topView.data=(topView.ctx=context||{}).root=from}if(""+tmplOrLinkExpr===tmplOrLinkExpr){addDataBinding(tmplOrLinkExpr,targetEl,parentView,undefined,true,from,context)}else{if(tmplOrLinkExpr.markup!==undefined){if(replaceMode){placeholderParent=targetEl.parentNode}html=tmplOrLinkExpr.render(from,context,noIteration,parentView,undefined,onRender);if(placeholderParent){prevNode=targetEl.previousSibling;nextNode=targetEl.nextSibling;$.cleanData([targetEl],true);placeholderParent.removeChild(targetEl);targetEl=placeholderParent}else{prevNode=nextNode=undefined;$(targetEl).empty()}}else if(tmplOrLinkExpr===true&&parentView===topView){refresh={lnk:1}}else{break}if(targetEl._df&&!nextNode){vwInfos=viewInfos(targetEl._df,true,rOpenViewMarkers);for(i=0,k=vwInfos.length;i<k;i++){view=vwInfos[i];if((view=viewStore[view.id])&&view.data!==undefined){view.parent.removeViews(view._.key,undefined,true)}}setDefer(targetEl)}parentView.link(from,targetEl,prevNode,nextNode,html,refresh,context)}if(topLevelCall){topView.data=topView.ctx=undefined}}}return to}function viewLink(outerData,parentNode,prevNode,nextNode,html,refresh,context,validateOnly){function convertMarkers(all,preceding,selfClose,closeTag,spaceBefore,id,boundId,spaceAfter,tag1,tag2,closeTag2,spaceAfterClose,selfClose2,endOpenTag){var errorMsg,bndId,endOfElCnt="";if(endOpenTag){inTag=0;return all}tag=tag1||tag2||"";closeTag=closeTag||closeTag2;selfClose=selfClose||selfClose2;if(isVoid&&!selfClose&&(!all||closeTag||tag||id&&!inTag)){isVoid=undefined;parentTag=tagStack.shift()}closeTag=closeTag||selfClose;if(closeTag){inTag=0;isVoid=undefined;if(validate){if(selfClose||selfClose2){if(!voidElems[parentTag]&&!/;svg;|;math;/.test(";"+tagStack.join(";")+";")){errorMsg="'<"+parentTag+".../"}}else if(voidElems[closeTag]){errorMsg="'</"+closeTag}else if(!tagStack.length||closeTag!==parentTag){errorMsg="Mismatch: '</"+closeTag}if(errorMsg){syntaxError(errorMsg+">' in:\n"+html)}}prevElCnt=elCnt;parentTag=tagStack.shift();elCnt=elContent[parentTag];closeTag2=closeTag2?"</"+closeTag2+">":"";if(prevElCnt){defer+=ids;ids="";if(!elCnt){endOfElCnt=closeTag2+openScript+"@"+defer+closeScript+(spaceAfterClose||"");defer=deferStack.shift()}else{defer+="-"}}}if(elCnt){if(id){ids+=id}else{preceding=closeTag2||selfClose2||""}if(tag){preceding+=tag;if(ids){preceding+=" "+jsvAttrStr+'="'+ids+'"';ids=""}}}else{preceding=id?preceding+endOfElCnt+spaceBefore+(inTag?"":openScript+id+closeScript)+spaceAfter+tag:endOfElCnt||all}if(validate&&boundId){if(inTag){syntaxError("{^{ within elem markup ("+inTag+' ). Use data-link="..."')}if(id.charAt(0)==="#"){tagStack.unshift(id.slice(1))}else if(id.slice(1)!==(bndId=tagStack.shift())){syntaxError("Closing tag for {^{...}} under different elem: <"+bndId+">")}}if(tag){inTag=tag;tagStack.unshift(parentTag);parentTag=tag.slice(1);if(validate&&tagStack[0]&&tagStack[0]===badParent[parentTag]){error("Parent of <tr> must be <tbody>")}isVoid=voidElems[parentTag];if((elCnt=elContent[parentTag])&&!prevElCnt){deferStack.unshift(defer);defer=""}prevElCnt=elCnt;if(defer&&elCnt){defer+="+"}}return preceding}function processViewInfos(vwInfos,targetParent){var deferPath,deferChar,bindChar,parentElem,id,onAftCr,deep,addedBindEls=[];if(vwInfos){if(vwInfos._tkns.charAt(0)==="@"){targetParent=elem.previousSibling;elem.parentNode.removeChild(elem);elem=undefined}len=vwInfos.length;while(len--){vwInfo=vwInfos[len];bindChar=vwInfo.ch;if(deferPath=vwInfo.path){j=deferPath.length-1;while(deferChar=deferPath.charAt(j--)){if(deferChar==="+"){if(deferPath.charAt(j)==="-"){j--;targetParent=targetParent.previousSibling}else{targetParent=targetParent.parentNode}}else{targetParent=targetParent.lastChild}}}if(bindChar==="^"){if(tag=bindingStore[id=vwInfo.id]){deep=targetParent&&(!elem||elem.parentNode!==targetParent);if(!elem||deep){tag.parentElem=targetParent}if(vwInfo.elCnt&&deep){setDefer(targetParent,(vwInfo.open?"#":"/")+id+bindChar+(targetParent._df||""))}addedBindEls.push([deep?null:elem,vwInfo])}}else if(view=viewStore[id=vwInfo.id]){if(!view.parentElem){view.parentElem=targetParent||elem&&elem.parentNode||parentNode;view._.onRender=addBindingMarkers;view._.onArrayChange=arrayChangeHandler;setArrayChangeLink(view)}parentElem=view.parentElem;if(vwInfo.open){view._elCnt=vwInfo.elCnt;if(targetParent&&!elem){setDefer(targetParent,"#"+id+bindChar+(targetParent._df||""))}else{if(!view._prv){setDefer(parentElem,removeSubStr(parentElem._df,"#"+id+bindChar))}view._prv=elem}}else{if(targetParent&&(!elem||elem.parentNode!==targetParent)){setDefer(targetParent,"/"+id+bindChar+(targetParent._df||""));view._nxt=undefined}else if(elem){if(!view._nxt){setDefer(parentElem,removeSubStr(parentElem._df,"/"+id+bindChar))}view._nxt=elem}if(onAftCr=view.ctx&&view.ctx[onAfterCreateStr]||onAfterCreate){onAftCr.call(view.ctx.tag,view)}}}}len=addedBindEls.length;while(len--){bindEls.push(addedBindEls[len])}}return!vwInfos||vwInfos.elCnt}function getViewInfos(vwInfos){var level,parentTag,named;if(vwInfos){len=vwInfos.length;for(j=0;j<len;j++){vwInfo=vwInfos[j];parentTag=tag=bindingStore[vwInfo.id].linkCtx.tag;named=tag.tagName===tagName;if(!tag.flow||named){if(!deep){level=1;while(parentTag=parentTag.parent){level++}tagDepth=tagDepth||level}if((deep||level===tagDepth)&&(!tagName||named)){tags.push(tag)}}}}}function dataLink(){var j,index,tokens="",wrap={},selector=linkViewsSel+(get?",["+deferAttr+"]":"");elems=qsa?parentNode.querySelectorAll(selector):$(selector,parentNode).get();l=elems.length;if(prevNode&&prevNode.innerHTML){prevNodes=qsa?prevNode.querySelectorAll(selector):$(selector,prevNode).get();prevNode=prevNodes.length?prevNodes[prevNodes.length-1]:prevNode}tagDepth=0;for(i=0;i<l;i++){elem=elems[i];if(prevNode&&!found){found=elem===prevNode}else if(nextNode&&elem===nextNode){if(get){tokens+=markerNodeInfo(elem)}break}else if(elem.parentNode){if(get){tokens+=markerNodeInfo(elem);if(elem._df){j=i+1;while(j<l&&elem.contains(elems[j])){j++}wrap[j-1]=elem._df}if(wrap[i]){tokens+=wrap[i]||""}}else{if(isLink&&(vwInfo=viewInfos(elem,undefined,rViewMarkers))&&(vwInfo=vwInfo[0])){skip=skip?vwInfo.id!==skip&&skip:vwInfo.open&&vwInfo.id}if(!skip&&processInfos(viewInfos(elem))&&elem.getAttribute($viewsLinkAttr)){bindEls.push([elem])}}}}if(get){tokens+=parentNode._df||"";if(index=tokens.indexOf("#"+get.id)+1){tokens=tokens.slice(index+get.id.length)}index=tokens.indexOf("/"+get.id);if(index+1){tokens=tokens.slice(0,index)}getViewInfos(viewInfos(tokens,undefined,rOpenTagMarkers))}if(html===undefined&&parentNode.getAttribute($viewsLinkAttr)){bindEls.push([parentNode])}unmarkPrevOrNextNode(prevNode,elCnt);unmarkPrevOrNextNode(nextNode,elCnt);if(get){if(lazyLink){lazyLink.resolve()}return}if(elCnt&&defer+ids){elem=nextNode;if(defer){if(nextNode){processViewInfos(viewInfos(defer+"+",true),nextNode)}else{processViewInfos(viewInfos(defer,true),parentNode)}}processViewInfos(viewInfos(ids,true),parentNode);if(nextNode){tokens=nextNode.getAttribute(jsvAttrStr);if(l=tokens.indexOf(prevIds)+1){tokens=tokens.slice(l+prevIds.length-1)}nextNode.setAttribute(jsvAttrStr,ids+tokens)}}l=bindEls.length;for(i=0;i<l;i++){elem=bindEls[i];linkInfo=elem[1];elem=elem[0];if(linkInfo){if(tag=bindingStore[linkInfo.id]){if(linkCtx=tag.linkCtx){tag=linkCtx.tag;tag.linkCtx=linkCtx}if(linkInfo.open){if(elem){tag.parentElem=elem.parentNode;tag._prv=elem}tag._elCnt=linkInfo.elCnt;view=tag.tagCtx.view;addDataBinding(undefined,tag._prv,view,linkInfo.id)}else{tag._nxt=elem;if(tag._.unlinked){tagCtx=tag.tagCtx;view=tagCtx.view;callAfterLink(tag)}}}}else{addDataBinding(elem.getAttribute($viewsLinkAttr),elem,$view(elem),undefined,isLink,outerData,context)}}if(lazyLink){lazyLink.resolve()}}var inTag,linkCtx,tag,i,l,j,len,elems,elem,view,vwInfo,linkInfo,prevNodes,token,prevView,nextView,node,tags,deep,tagName,tagCtx,validate,tagDepth,depth,fragment,copiedNode,firstTag,parentTag,isVoid,wrapper,div,tokens,elCnt,prevElCnt,htmlTag,ids,prevIds,found,skip,lazyLink,isLink,get,self=this,thisId=self._.id+"_",defer="",bindEls=[],tagStack=[],deferStack=[],onAfterCreate=self.hlp(onAfterCreateStr),processInfos=processViewInfos;if(refresh){lazyLink=refresh.lazyLink&&$.Deferred();if(refresh.tmpl){prevView="/"+refresh._.id+"_"}else{isLink=refresh.lnk;if(refresh.tag){thisId=refresh.tag+"^";refresh=true}if(get=refresh.get){processInfos=getViewInfos;tags=get.tags;deep=get.deep;tagName=get.name}}refresh=refresh===true}parentNode=parentNode?""+parentNode===parentNode?$(parentNode)[0]:parentNode.jquery?parentNode[0]:parentNode:self.parentElem||document.body;validate=!$subSettingsAdvanced.noValidate&&parentNode.contentEditable!==TRUE;parentTag=parentNode.tagName.toLowerCase();elCnt=!!elContent[parentTag];prevNode=prevNode&&markPrevOrNextNode(prevNode,elCnt);nextNode=nextNode&&markPrevOrNextNode(nextNode,elCnt)||null;if(html!=undefined){div=document.createElement("div");wrapper=div;prevIds=ids="";htmlTag=parentNode.namespaceURI==="http://www.w3.org/2000/svg"?"svg_ns":(firstTag=rFirstElem.exec(html))&&firstTag[1]||"";if(elCnt){node=nextNode;while(node&&!(nextView=viewInfos(node))){node=node.nextSibling}if(tokens=nextView?nextView._tkns:parentNode._df){token=prevView||"";if(refresh||!prevView){token+="#"+thisId}j=tokens.indexOf(token);if(j+1){j+=token.length;prevIds=ids=tokens.slice(0,j);tokens=tokens.slice(j);if(nextView){node.setAttribute(jsvAttrStr,tokens)}else{setDefer(parentNode,tokens)}}}}isVoid=undefined;html=(""+html).replace(rConvertMarkers,convertMarkers);if(validate&&tagStack.length){syntaxError("Mismatched '<"+parentTag+"...>' in:\n"+html)}if(validateOnly){return}safeFragment.appendChild(div);htmlTag=wrapMap[htmlTag]||wrapMap.div;depth=htmlTag[0];wrapper.innerHTML=htmlTag[1]+html+htmlTag[2];while(depth--){wrapper=wrapper.lastChild}safeFragment.removeChild(div);fragment=document.createDocumentFragment();while(copiedNode=wrapper.firstChild){fragment.appendChild(copiedNode)}parentNode.insertBefore(fragment,nextNode)}if(lazyLink){setTimeout(dataLink,0)}else{dataLink()}return lazyLink&&lazyLink.promise()}function addDataBinding(linkMarkup,node,currentView,boundTagId,isLink,data,context){var tmpl,tokens,attr,convertBack,tagExpr,linkFn,linkCtx,tag,rTagIndex,hasElse,lastIndex,linkExpressions=[];if(boundTagId){tag=bindingStore[boundTagId];tag=tag.linkCtx?tag.linkCtx.tag:tag;linkCtx=tag.linkCtx||{type:"inline",data:currentView.data,elem:tag._elCnt?tag.parentElem:node,view:currentView,ctx:currentView.ctx,attr:HTML,fn:tag._.bnd,tag:tag,_bndId:boundTagId};bindDataLinkTarget(linkCtx,linkCtx.fn)}else if(linkMarkup&&node){data=isLink?data:currentView.data;tmpl=currentView.tmpl;linkMarkup=normalizeLinkTag(linkMarkup,defaultAttr(node));lastIndex=rTagDatalink.lastIndex=0;while(tokens=rTagDatalink.exec(linkMarkup)){linkExpressions.push(tokens);lastIndex=rTagDatalink.lastIndex}if(lastIndex<linkMarkup.length){syntaxError(linkMarkup)}while(tokens=linkExpressions.shift()){rTagIndex=rTagDatalink.lastIndex;attr=tokens[1];tagExpr=tokens[3];while(linkExpressions[0]&&linkExpressions[0][4]==="else"){tagExpr+=delimCloseChar1+delimOpenChar0+linkExpressions.shift()[3];hasElse=true}if(hasElse){tagExpr+=delimCloseChar1+delimOpenChar0+delimOpenChar1+"/"+tokens[4]+delimCloseChar0}linkCtx={type:isLink?"top":"link",data:data,elem:node,view:currentView,ctx:context,attr:attr,isLk:isLink,_toLk:1,_noUpd:tokens[2]};convertBack=undefined;if(tokens[6]){convertBack=tokens[10]||undefined;linkCtx.convert=tokens[5]||"";if(!attr&&convertBack!==undefined&&defaultAttr(node)){linkCtx.convertBack=convertBack=convertBack.slice(1)}}linkCtx.expr=attr+tagExpr;linkFn=tmpl.links[tagExpr];if(!linkFn){tmpl.links[tagExpr]=linkFn=$sub.tmplFn(tagExpr,tmpl,true,convertBack,hasElse)}linkCtx.fn=linkFn;bindDataLinkTarget(linkCtx,linkFn);rTagDatalink.lastIndex=rTagIndex}}}function bindDataLinkTarget(linkCtx,linkFn){function handler(ev,eventArgs){propertyChangeHandler.call(linkCtx,ev,eventArgs,linkFn)}handler.noArray=true;if(linkCtx.isLk){addLinkMethods(linkCtx.view=new $sub.View($sub.extendCtx(linkCtx.ctx,linkCtx.view.ctx),"link",linkCtx.view,linkCtx.data,linkCtx.expr,undefined,addBindingMarkers))}linkCtx._ctxCb=$sub._gccb(linkCtx.view);linkCtx._hdl=handler;handler(true)}function removeSubStr(str,substr){var k;return str?(k=str.indexOf(substr),k+1?str.slice(0,k)+str.slice(k+substr.length):str):""}function markerNodeInfo(node){return node&&(""+node===node?node:node.tagName===SCRIPT?node.type.slice(3):node.nodeType===1&&node.getAttribute(jsvAttrStr)||"")}function viewInfos(node,isVal,rBinding){function getInfos(all,open,close,id,ch,elPath){infos.push({elCnt:elCnt,id:id,ch:ch,open:open,close:close,path:elPath,token:all})}var elCnt,tokens,infos=[];if(tokens=isVal?node:markerNodeInfo(node)){elCnt=infos.elCnt=node.tagName!==SCRIPT;elCnt=tokens.charAt(0)==="@"||elCnt;infos._tkns=tokens;tokens.replace(rBinding||rMarkerTokens,getInfos);return infos}}function unmarkPrevOrNextNode(node,elCnt){if(node){if(node.type==="jsv"){node.parentNode.removeChild(node)}else if(elCnt&&node.getAttribute($viewsLinkAttr)===""){node.removeAttribute($viewsLinkAttr)}}}function markPrevOrNextNode(node,elCnt){var marker=node;while(elCnt&&marker&&marker.nodeType!==1){marker=marker.previousSibling}if(marker){if(marker.nodeType!==1){marker=document.createElement(SCRIPT);marker.type="jsv";node.parentNode.insertBefore(marker,node)}else if(!markerNodeInfo(marker)&&!marker.getAttribute($viewsLinkAttr)){marker.setAttribute($viewsLinkAttr,"")}}return marker}function normalizeLinkTag(linkMarkup,twoway){linkMarkup=$.trim(linkMarkup).replace(rEscapeQuotes,"\\$&");return linkMarkup.slice(-1)!==delimCloseChar0?linkMarkup=delimOpenChar1+":"+linkMarkup+(twoway?":":"")+delimCloseChar0:linkMarkup}function callAfterLink(tag,ev,eventArgs){var linkedElem,displayElem,linkedEl,val,l,linkedTag,oldTrig,newTrig,tagProps,propsExpr,linkedElemView,prop,propDef,tagCtx=tag.tagCtx,view=tagCtx.view,props=tagCtx.props,linkCtx=tag.linkCtx;if(tag._.unlinked){if(tag.linkedElement!==undefined){tag.linkedElem=tag._.inline?tag.contents(true,tag.linkedElement||"*").first():$(linkCtx.elem)}if(tag.onBind){tag.onBind(tagCtx,linkCtx,tag.ctx,ev,eventArgs)}}if(tag.onAfterLink){tag.onAfterLink(tagCtx,linkCtx,tag.ctx,ev,eventArgs)}linkedElem=tag.targetTag?tag.targetTag.linkedElem:tag.linkedElem;displayElem=tag.displayElem||linkedElem;if(linkedElem&&linkedElem[0]){val=tag.cvtArgs()[0];if(val!==undefined&&!tag._.chging){l=linkedElem.length;while(l--){linkedEl=linkedElem[l];if(tag._.unlinked&&linkedEl!==linkCtx.elem){linkedTag=linkedEl._jsvLkEl;if(tag._.inline&&(!linkedTag||linkedTag!==tag&&linkedTag.targetTag!==tag)){linkedEl._jsvLkEl=tag;bindTo(bindingStore[tag._tgId],tag,linkedEl);linkedEl._jsvBnd="&"+tag._tgId+"+"}}if(val!==undefined){if(linkedEl.value!==undefined){if(linkedEl.type===CHECKBOX){linkedEl[CHECKED]=val&&val!=="false"}else if(linkedEl.type===RADIO){linkedEl[CHECKED]=linkedEl.value===val}else{$(linkedEl).val(val)}}else if(linkedEl.contentEditable===TRUE){linkedEl.innerHTML=val}linkCtx._val=val}if(props.name){linkedEl.name=linkedEl.name||props.name}}}if(tag.setSize){if(props.height){displayElem.height(props.height)}if(props.width){displayElem.width(props.width)}}if(props.title!==undefined){displayElem.attr("title",props.title)}if(props["class"]){if(eventArgs&&displayElem.hasClass(eventArgs.oldValue)){displayElem.removeClass(eventArgs.oldValue)}displayElem.addClass(props["class"])}if(props.id){linkedElem[0].id=props.id}}tag._.unlinked=undefined}function asyncElemChangeHandler(ev){setTimeout(function(){elemChangeHandler(ev)},0)}function bindElChange($elem,trig,onoff){if(trig){trig=""+trig===trig?trig:"keydown";$elem[onoff](trig,trig==="keydown"?asyncElemChangeHandler:elemChangeHandler)}}function bindTo(binding,tag,linkedElem,cvtBk){var bindto,pathIndex,path,lastPath,bindtoOb,$linkedElem,newTrig,oldTrig,to,l,linkCtx=binding.linkCtx,contextCb=linkCtx._ctxCb,source=linkCtx.data,paths=linkCtx.fn.paths[0];
tag=tag||linkedElem._jsvLkEl;if(binding&&paths&&!binding.to){oldTrig=linkedElem._jsvTr||false;if(tag){cvtBk=tag.convertBack||cvtBk;newTrig=tag.tagCtx.props.trigger}newTrig=newTrig===undefined?$subSettings.trigger:newTrig;newTrig=newTrig&&(linkedElem.tagName==="INPUT"&&linkedElem.type!==CHECKBOX&&linkedElem.type!==RADIO||linkedElem.type==="textarea"||linkedElem.contentEditable===TRUE)&&newTrig||false;if(oldTrig!==newTrig){$linkedElem=$(linkedElem);bindElChange($linkedElem,oldTrig,"off");bindElChange($linkedElem,linkedElem._jsvTr=newTrig,"on")}paths=(bindto=paths._jsvto)||paths[0];if(pathIndex=paths&&paths.length){lastPath=paths[pathIndex-1];if(lastPath._jsv){bindtoOb=lastPath;while(lastPath.sb&&lastPath.sb._jsv){path=lastPath=lastPath.sb}path=lastPath.sb||path&&path.path;lastPath=path?path.slice(1):bindtoOb.path}if(path){to=[bindtoOb,lastPath]}else{while((to=contextCb(path=lastPath.split("^").join("."),source))&&(l=to.length)){if(to[0]._cp){to=to[0];contextCb=$sub._gccb(to[0]);lastPath=to[1];to=[to[0].data,to[1]];if(lastPath._jsv){bindtoOb=lastPath;bindtoOb.data=to[0];bindtoOb._cpCtx=contextCb;while(lastPath.sb&&lastPath.sb._jsv){path=lastPath=lastPath.sb}path=lastPath.sb||path&&path.path;lastPath=path?path.slice(1):bindtoOb.path;to=[bindtoOb,lastPath]}}else{to=l>2?[to[l-3],to[l-2]]:[to[l-2]]}source=to[0];lastPath=to[1]}to=to||[source,path]}}else{to=[]}binding.to=[to,cvtBk]}}function mergeCtxs(tag,newCtxs,replace){var tagCtx,newTagCtx,view=tag.tagCtx.view,tagCtxs=tag.tagCtxs||[tag.tagCtx],l=tagCtxs.length,refresh=!newCtxs;newCtxs=newCtxs||tag._.bnd.call(view.tmpl,(tag.linkCtx||view).data,view,$sub);if(replace){tagCtxs=tag.tagCtxs=newCtxs;tag.tagCtx=tagCtxs[0]}else{while(l--){tagCtx=tagCtxs[l];newTagCtx=newCtxs[l];$observable(tagCtx.props).setProperty(newTagCtx.props);$extend(tagCtx.ctx,newTagCtx.ctx);tagCtx.args=newTagCtx.args;if(refresh){tagCtx.tmpl=newTagCtx.tmpl}}}$sub._ths(tag,tagCtxs[0]);return tagCtxs}function clean(elems){var l,elem,bindings,elemArray=[],len=elems.length,i=len;while(i--){elemArray.push(elems[i])}i=len;while(i--){elem=elemArray[i];if(elem.parentNode){if(bindings=elem._jsvBnd){bindings=bindings.slice(1).split("&");elem._jsvBnd="";l=bindings.length;while(l--){removeViewBinding(bindings[l],elem._jsvLkEl,elem)}}disposeTokens(markerNodeInfo(elem)+(elem._df||""))}}}function removeViewBinding(bindId,linkedElemTag,elem){var objId,linkCtx,tag,object,obsId,tagCtxs,l,map,$linkedElem,linkedElem,trigger,view,targetTag,binding=bindingStore[bindId];if(linkedElemTag){linkedElemTag=linkedElemTag.targetTag||linkedElemTag;elem._jsvLkEl=undefined}else if(binding){delete bindingStore[bindId];for(objId in binding.bnd){object=binding.bnd[objId];obsId=binding.cbId;if($isArray(object)){$([object]).off(arrayChangeStr+obsId).off(propertyChangeStr+obsId)}else{$(object).off(propertyChangeStr+obsId)}delete binding.bnd[objId]}if(linkCtx=binding.linkCtx){if(tag=linkCtx.tag){if(tagCtxs=tag.tagCtxs){l=tagCtxs.length;while(l--){if(map=tagCtxs[l].map){map.unmap()}}}$linkedElem=tag.linkedElem;if(tag.onUnbind){tag.onUnbind(tag.tagCtx,linkCtx,tag.ctx,true)}if(tag.onDispose){tag.onDispose()}if(!tag._elCnt){if(tag._prv){tag._prv.parentNode.removeChild(tag._prv)}if(tag._nxt){tag._nxt.parentNode.removeChild(tag._nxt)}}}linkedElem=$linkedElem&&$linkedElem[0]||linkCtx.elem;if(trigger=linkedElem&&linkedElem._jsvTr){bindElChange($linkedElem||$(linkedElem),trigger,"off");linkedElem._jsvTr=undefined}view=linkCtx.view;if(view.type==="link"){view.parent.removeViews(view._.key,undefined,true)}else{delete view._.bnds[bindId]}}delete binding.s[binding.cbId]}}function $unlink(to){if(to){to=to.jquery?to:$(to);to.each(function(){var innerView;while((innerView=$view(this,true))&&innerView.parent){innerView.parent.removeViews(innerView._.key,undefined,true)}clean(this.getElementsByTagName("*"))});clean(to)}else{if(activeBody){$(activeBody).off(elementChangeStr,elemChangeHandler).off("blur","[contenteditable]",elemChangeHandler);activeBody=undefined}topView.removeViews();clean(document.body.getElementsByTagName("*"))}}function inputAttrib(elem){return elem.type===CHECKBOX?elem[CHECKED]:elem.value}$sub.onStore.template=function(name,item){item.link=tmplLink;if(name){$.link[name]=function(){return tmplLink.apply(item,arguments)}}};$sub.viewInfos=viewInfos;($viewsSettings.delimiters=function(){var ret=oldJsvDelimiters.apply(0,arguments),delimChars=$subSettings.delimiters;delimOpenChar0=delimChars[0].charAt(0);delimOpenChar1=delimChars[0].charAt(1);delimCloseChar0=delimChars[1].charAt(0);delimCloseChar1=delimChars[1].charAt(1);linkChar=delimChars[2];rTagDatalink=new RegExp("(?:^|\\s*)([\\w-]*)(\\"+linkChar+")?(\\"+delimOpenChar1+$sub.rTag+"(:\\w*)?\\"+delimCloseChar0+")","g");return ret})();$sub.addSetting("trigger");function transferViewTokens(prevNode,nextNode,parentElem,id,viewOrTagChar,refresh){var i,l,vwInfos,vwInfo,viewOrTag,viewId,tokens,precedingLength=0,emptyView=prevNode===nextNode;if(prevNode){vwInfos=viewInfos(prevNode)||[];for(i=0,l=vwInfos.length;i<l;i++){vwInfo=vwInfos[i];viewId=vwInfo.id;if(viewId===id&&vwInfo.ch===viewOrTagChar){if(refresh){l=0}else{break}}if(!emptyView){viewOrTag=vwInfo.ch==="_"?viewStore[viewId]:bindingStore[viewId].linkCtx.tag;if(vwInfo.open){viewOrTag._prv=nextNode}else if(vwInfo.close){viewOrTag._nxt=nextNode}}precedingLength+=viewId.length+2}if(precedingLength){prevNode.setAttribute(jsvAttrStr,prevNode.getAttribute(jsvAttrStr).slice(precedingLength))}tokens=nextNode?nextNode.getAttribute(jsvAttrStr):parentElem._df;if(l=tokens.indexOf("/"+id+viewOrTagChar)+1){tokens=vwInfos._tkns.slice(0,precedingLength)+tokens.slice(l+(refresh?-1:id.length+1))}if(tokens){if(nextNode){nextNode.setAttribute(jsvAttrStr,tokens)}else{setDefer(parentElem,tokens)}}}else{setDefer(parentElem,removeSubStr(parentElem._df,"#"+id+viewOrTagChar));if(!refresh&&!nextNode){setDefer(parentElem,removeSubStr(parentElem._df,"/"+id+viewOrTagChar))}}}function disposeTokens(tokens){var i,l,vwItem,vwInfos;if(vwInfos=viewInfos(tokens,true,rOpenMarkers)){for(i=0,l=vwInfos.length;i<l;i++){vwItem=vwInfos[i];if(vwItem.ch==="_"){if((vwItem=viewStore[vwItem.id])&&vwItem.type){vwItem.parent.removeViews(vwItem._.key,undefined,true)}}else{removeViewBinding(vwItem.id)}}}}function addLinkMethods(tagOrView,isTag){tagOrView.contents=function(deep,select){if(deep!==!!deep){select=deep;deep=undefined}var filtered,nodes=$(this.nodes());if(nodes[0]){filtered=select?nodes.filter(select):nodes;nodes=deep&&select?filtered.add(nodes.find(select)):filtered}return nodes};tagOrView.nodes=function(withMarkers,prevNode,nextNode){var node,self=this,elCnt=self._elCnt,prevIsFirstNode=!prevNode&&elCnt,nodes=[];prevNode=prevNode||self._prv;nextNode=nextNode||self._nxt;node=prevIsFirstNode?prevNode===self._nxt?self.parentElem.lastSibling:prevNode:self._.inline===false?prevNode||self.linkCtx.elem.firstChild:prevNode&&prevNode.nextSibling;while(node&&(!nextNode||node!==nextNode)){if(withMarkers||elCnt||node.tagName!==SCRIPT){nodes.push(node)}node=node.nextSibling}return nodes};tagOrView.childTags=function(deep,tagName){if(deep!==!!deep){tagName=deep;deep=undefined}var self=this,view=self.link?self:self.tagCtx.view,prevNode=self._prv,elCnt=self._elCnt,tags=[];view.link(undefined,self.parentElem,elCnt?prevNode&&prevNode.previousSibling:prevNode,self._nxt,undefined,{get:{tags:tags,deep:deep,name:tagName,id:self.link?self._.id+"_":self._tgId+"^"}});return tags};tagOrView.refresh=function(sourceValue){var promise,attr,tag=this,linkCtx=tag.linkCtx,view=tag.tagCtx.view;if(tag.disposed){error("Removed tag")}if(sourceValue===undefined){sourceValue=$sub._tag(tag,view,view.tmpl,mergeCtxs(tag),true)}if(sourceValue+""===sourceValue){if(tag.onUnbind){tag.onUnbind(tag.tagCtx,linkCtx,tag.ctx)}attr=tag._.inline?HTML:linkCtx.attr||defaultAttr(tag.parentElem,true);promise=updateContent(sourceValue,linkCtx,attr,tag)}callAfterLink(tag);return promise||tag};tagOrView.update=function(value){var linkedElem=this.linkedElem;if(linkedElem){elemChangeHandler({target:linkedElem[0]},undefined,value)}};if(isTag){tagOrView.domChange=function(){var elem=this.parentElem,hasListener=$.hasData(elem)&&$._data(elem).events,domChangeNotification="jsv-domchange";if(hasListener&&hasListener[domChangeNotification]){$(elem).triggerHandler(domChangeNotification,arguments)}}}else{tagOrView.addViews=function(index,dataItems){var i,viewsCount,self=this,itemsCount=dataItems.length,views=self.views;if(!self._.useKey&&itemsCount){viewsCount=views.length+itemsCount;if(viewsCount===self.data.length&&renderAndLink(self,index,self.tmpl,views,dataItems,self.ctx)!==false){if(!self._.srt){self.fixIndex(index+itemsCount)}}}};tagOrView.removeViews=function(index,itemsCount,keepNodes,isMove){function removeView(index){var id,bindId,parentElem,prevNode,nextNode,nodesToRemove,viewToRemove=views[index];if(viewToRemove&&viewToRemove.link){id=viewToRemove._.id;if(!keepNodes){nodesToRemove=viewToRemove.nodes()}viewToRemove.removeViews(undefined,undefined,true);viewToRemove.type=undefined;prevNode=viewToRemove._prv;nextNode=viewToRemove._nxt;parentElem=viewToRemove.parentElem;if(!keepNodes){if(viewToRemove._elCnt){transferViewTokens(prevNode,nextNode,parentElem,id,"_")}$(nodesToRemove).remove()}if(!viewToRemove._elCnt){try{prevNode.parentNode.removeChild(prevNode);nextNode.parentNode.removeChild(nextNode)}catch(e){}}setArrayChangeLink(viewToRemove);for(bindId in viewToRemove._.bnds){removeViewBinding(bindId)}delete viewStore[id]}}var current,view,viewsCount,self=this,isArray=!self._.useKey,views=self.views;if(isArray){viewsCount=views.length}if(index===undefined){if(isArray){current=viewsCount;while(current--){removeView(current)}self.views=[]}else{for(view in views){removeView(view)}self.views={}}}else{if(itemsCount===undefined){if(isArray){itemsCount=1}else{removeView(index);delete views[index]}}if(isArray&&itemsCount&&(isMove||viewsCount-itemsCount===self.data.length)){current=index+itemsCount;while(current-->index){removeView(current)}views.splice(index,itemsCount);if(!self._.sort){self.fixIndex(index)}}}};tagOrView.refresh=function(){var self=this,parent=self.parent;if(parent){renderAndLink(self,self.index,self.tmpl,parent.views,self.data,undefined,true);setArrayChangeLink(self)}};tagOrView.fixIndex=function(fromIndex){var views=this.views,index=views.length;while(fromIndex<index--){if(views[index].index!==index){$observable(views[index]).setProperty("index",index)}}};tagOrView.link=viewLink}}$converters.merge=function(val){var regularExpression,currentValue=this.linkCtx._val||"",toggle=this.tagCtx.props.toggle;if(toggle){regularExpression=toggle.replace(/[\\^$.|?*+()[{]/g,"\\$&");regularExpression="(\\s(?="+regularExpression+"$)|(\\s)|^)("+regularExpression+"(\\s|$))";currentValue=currentValue.replace(new RegExp(regularExpression),"$2");val=currentValue+(val?(currentValue&&" ")+toggle:"")}return val};function keepParentDataCtx(val){return this.tagCtx.view}$tags({on:{attr:NONE,init:function(tagCtx){var content,tag=this,i=0,args=tagCtx.args,l=args.length;for(;i<l&&!$isFunction(args[i]);i++);tag._hi=l>i&&i+1;if(tag._.inline){if(!$sub.rTmpl.exec(content=tagCtx.tmpl.markup)){tag.template="<button>"+($.trim(content)||tagCtx.params.args[i]||"noop")+"</button>"}tag.attr=HTML}},onAfterLink:function(tagCtx,linkCtx){var handler,params,find,activeElem,tag=this,i=tag._hi,args=tagCtx.args,l=args.length,props=tagCtx.props,data=props.data,view=tagCtx.view,contextOb=props.context;if(i){handler=args[i-1];params=args.slice(i);args=args.slice(0,i-1);tag._sel=args[1];activeElem=tag.activeElem=tag.activeElem||$(tag._.inline?(tag._sel=args[1]||"*",tag.parentElem):linkCtx.elem);if(!contextOb){contextOb=/^(.*)[\.^][\w$]+$/.exec(tagCtx.params.args.slice(-params.length-1)[0]);contextOb=contextOb&&$sub.tmplFn(delimOpenChar1+":"+contextOb[1]+delimCloseChar0,view.tmpl,true)(linkCtx.data,view)}if(tag._evs){tag.onUnbind()}activeElem.on(tag._evs=args[0]||"click",tag._sel,data==undefined?null:data,tag._hlr=function hndlr(ev){var nodes,length,found=!tag._.inline;if(!found){nodes=tag.contents("*");l=nodes.length;while(!found&&l--){if(nodes[l].contains(ev.target)){found=true}}}if(found){return handler.apply(contextOb||linkCtx.data,[].concat(params,ev,{change:ev.type,view:view,linkCtx:linkCtx},params.slice.call(arguments,1)))}})}},onUpdate:function(){return false},onUnbind:function(){var self=this;if(self.activeElem){self.activeElem.off(self._evs,self._sel,self._hlr)}},flow:true,contentCtx:keepParentDataCtx,dataBoundOnly:true},radiogroup:{init:function(tagCtx){this.name=tagCtx.props.name||"jsv"+Math.random()},onBind:function(tagCtx,linkCtx){var domChngCntnr,tag=this,$linkedElem=tag.linkedElem=tag._.inline?tag.contents(true,"input[type=radio]"):$(linkCtx.elem).find("input[type=radio]"),l=$linkedElem.length;if(tag._.inline){domChngCntnr=tag.contents("*")[0];domChngCntnr=domChngCntnr&&$.view(domChngCntnr).ctx.tag===tag.parent?domChngCntnr:tag.parentElem}else{domChngCntnr=linkCtx.elem}while(l--){$linkedElem[l].name=$linkedElem[l].name||tag.name}$(domChngCntnr).on("jsv-domchange",function(ev,forOrIfTagCtx){var linkedElem,parentTags=forOrIfTagCtx.ctx.parentTags;if(!tag._.inline||domChngCntnr!==tag.parentElem||parentTags&&parentTags[tag.tagName]===tag){$linkedElem=tag.linkedElem=tag.contents(true,"input[type=radio]");l=$linkedElem.length;while(l--){linkedElem=$linkedElem[l];linkedElem._jsvLkEl=tag;linkedElem.name=linkedElem.name||tag.name;bindTo(bindingStore[tag._tgId],tag,linkedElem);linkedElem._jsvBnd="&"+tag._tgId+"+";linkedElem.checked=tag.cvtArgs()[0]===linkedElem.value}}})},onUpdate:function(ev,eventArgs,tagCtxs){return false},contentCtx:keepParentDataCtx,dataBoundOnly:true}});$extend($tags["for"],{onArrayChange:function(ev,eventArgs,tagCtx,linkCtx){var arrayView,target=ev.target,targetLength=target.length,tag=this,change=eventArgs.change;if(tag._.noVws||tag.tagCtxs[1]&&(change==="insert"&&targetLength===eventArgs.items.length||change==="remove"&&!targetLength)){tag.refresh()}else{for(arrayView in tag._.arrVws){arrayView=tag._.arrVws[arrayView];if(arrayView.data===target){arrayView._.onArrayChange.apply(arrayView,arguments)}}}tag.domChange(tagCtx,linkCtx,eventArgs);ev.done=true},onAfterLink:function(tagCtx,linkCtx){var i,arrHandler,arrBinding,data,tag=this,arrayBindings=tag._ars||{},tagCtxs=tag.tagCtxs,l=tagCtxs.length,selected=tag.selected||0;for(i=0;i<=selected;i++){tagCtx=tagCtxs[i];data=tagCtx.map?tagCtx.map.tgt:tagCtx.args.length?tagCtx.args[0]:tagCtx.view.data;if((arrBinding=arrayBindings[i])&&data!==arrBinding[0]){$observe(arrBinding[0],arrBinding[1],true);delete arrayBindings[i]}if(!arrayBindings[i]&&$isArray(data)){$observe(data,arrHandler=function(ev,eventArgs){var tagCt=tagCtx;tag.onArrayChange(ev,eventArgs,tagCt,linkCtx)});arrayBindings[i]=[data,arrHandler]}}for(i=selected+1;i<l;i++){if(arrBinding=arrayBindings[i]){$observe(arrBinding[0],arrBinding[1],true);delete arrayBindings[i]}}tag._ars=arrayBindings},onDispose:function(){var l,tag=this;for(l in tag._ars){$observe(tag._ars[l][0],tag._ars[l][1],true)}}});$extend($tags["if"],{onUpdate:function(ev,eventArgs,newTagCtxs){var tci,prevArg,different;for(tci=0;prevArg=this.tagCtxs[tci];tci++){different=prevArg.props.tmpl!==newTagCtxs[tci].props.tmpl||prevArg.args.length&&!(prevArg=prevArg.args[0])!==!newTagCtxs[tci].args[0];if(!this.convert&&!!prevArg||different){return different}}return false},onAfterLink:function(tagCtx,linkCtx,ctx,ev,eventArgs){if(eventArgs){this.domChange(tagCtx,linkCtx,eventArgs)}}});function observeProps(map,ev,eventArgs){if(eventArgs.change==="set"){var target=map.tgt,l=target.length;while(l--){if(target[l].key===eventArgs.path){break}}if(l===-1){if(eventArgs.path&&!eventArgs.remove){$observable(target).insert({key:eventArgs.path,prop:eventArgs.value})}}else if(eventArgs.remove){$observable(target).remove(l)}else{$observable(target[l]).setProperty("prop",eventArgs.value)}}}function observeMappedProps(map,ev,eventArgs){var item,source=map.src,change=eventArgs.change;if(change==="set"){if(eventArgs.path==="prop"){$observable(source).setProperty(ev.target.key,eventArgs.value)}else{$observable(source).removeProperty(eventArgs.oldValue);$observable(source).setProperty(eventArgs.value,ev.target.prop)}}else if(change==="remove"){item=eventArgs.items[0];$observable(source).removeProperty(item.key);delete source[item.key]}else if(change==="insert"){item=eventArgs.items[0];if(item.key){$observable(source).setProperty(item.key,item.prop)}}}function shallowArrayFilter(allPath){return allPath.indexOf(".")<0}$tags("props",{baseTag:"for",dataMap:$views.map({getTgt:$tags.props.dataMap.getTgt,obsSrc:observeProps,obsTgt:observeMappedProps,tgtFlt:shallowArrayFilter}),flow:true});$extend($,{view:$view=function(node,inner,type){function getInnerView(nd,isVl){if(nd){vwInfos=viewInfos(nd,isVl,rOpenViewMarkers);for(j=0,k=vwInfos.length;j<k;j++){if((view=viewStore[vwInfos[j].id])&&(view=view&&type?view.get(true,type):view)){break}}}}if(inner!==!!inner){type=inner;inner=undefined}var view,vwInfos,i,j,k,l,elems,level=0,body=document.body;if(node&&node!==body&&topView._.useKey>1){node=""+node===node?$(node)[0]:node.jquery?node[0]:node;if(node){if(inner){getInnerView(node._df,true);if(!view){elems=qsa?node.querySelectorAll(bindElsSel):$(bindElsSel,node).get();l=elems.length;for(i=0;!view&&i<l;i++){getInnerView(elems[i])}}return view}while(node){if(vwInfos=viewInfos(node,undefined,rViewMarkers)){l=vwInfos.length;while(l--){view=vwInfos[l];if(view.open){if(level<1){view=viewStore[view.id];return view&&type?view.get(type):view||topView}level--}else{level++}}}node=node.previousSibling||node.parentNode}}}return topView},link:$link,unlink:$unlink,cleanData:function(elems){if(elems.length&&isCleanCall){clean(elems)}oldCleanData.apply($,arguments)}});$extend($.fn,{link:function(expr,from,context,noIteration,parentView,prevNode,nextNode){return $link(expr,this,from,context,noIteration,parentView,prevNode,nextNode)},unlink:function(){return $unlink(this)},view:function(inner,type){return $view(this[0],inner,type)}});$.each([HTML,"replaceWith","empty","remove"],function(i,name){var oldFn=$.fn[name];$.fn[name]=function(){var result;isCleanCall=1;try{result=oldFn.apply(this,arguments)}finally{isCleanCall=0}return result}});addLinkMethods($extend(topView=$sub.topView,{tmpl:{links:{}}}));viewStore={0:topView};$views.getCtx=function(param){if(param&&param._cp){param=param[1](param[0].data,param[0],$sub)}return param};$sub._cp=function(paramVal,params,view){if(view.linked){params=delimOpenChar1+":"+params+delimCloseChar0;var tmpl=view.tmpl,links=topView.tmpl.links,linkFn=links[params];if(!linkFn){links[params]=linkFn=$sub.tmplFn(params,tmpl,true)}paramVal=[view,linkFn];paramVal._cp=true}return paramVal};$sub._ceo=function cloneExprObjects(obs){var ob,clones=obs,l=obs.length;if(l){clones=[];while(l--){ob=obs[l];if(ob._jsv){ob=$extend({},ob);ob.prm=cloneExprObjects(ob.prm)}clones.unshift(ob)}}return clones};$sub._gccb=function(view){return function(path,object,depth){var tokens,tag,items,helper,last,nextPath,l;if(view&&path){if(path._jsv){return path._jsv.call(view.tmpl,object,view,$sub)}if(path.charAt(0)==="~"){if(path.slice(0,4)==="~tag"){tag=view.ctx;if(path.charAt(4)==="."){tokens=path.slice(5).split(".");tag=tag.tag}if(tokens){return tag?[tag,tokens.join("."),object]:[]}}path=path.slice(1).split(".");if(helper=view.hlp(last=path.shift(),true)){if(helper._cp){if(path.length){nextPath="."+path.join(".");last=helper[l=helper.length-1];if(last._jsv){last.sb=nextPath;last.bnd=!!depth}else{helper[l]=(last+nextPath).replace("#data.","");if(last.slice(0,5)==="#view"){helper[l]=helper[l].slice(6);helper.splice(l,0,view)}}}items=[helper]}else if(path.length||$isFunction(helper)){items=[helper,path.join("."),object]}}return items||[]}if(path.charAt(0)==="#"){return path==="#data"?[]:[view,path.replace(rViewPath,""),object]}}}};oldAdvSet=$sub.advSet;$sub.advSet=function(){oldAdvSet.call($sub);global._jsv=$subSettingsAdvanced._jsv?$extend(global._jsv||{},{views:viewStore,bindings:bindingStore}):undefined;$viewsLinkAttr=$subSettingsAdvanced.linkAttr;linkViewsSel=bindElsSel+",["+$viewsLinkAttr+"]";wrapMap=$subSettingsAdvanced._wm;wrapMap.optgroup=wrapMap.option;wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.thead;wrapMap.th=wrapMap.td};$viewsSettings.advanced({linkAttr:"data-link",useViews:false,noValidate:false,_wm:{option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],svg_ns:[1,"<svg>","</svg>"],div:$.support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},_fe:{input:{from:inputAttrib,to:"value"},textarea:valueBinding,select:valueBinding,optgroup:{to:"label"}}});return $},window);