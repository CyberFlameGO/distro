!function(t){jQuery.fn.farbtastic=function(o){return t.farbtastic(this,o),this},jQuery.farbtastic=function(o,e){return(o=t(o).get(0)).farbtastic||(o.farbtastic=new jQuery._farbtastic(o,e))},jQuery._farbtastic=function(o,e){var a=this;t(o).html('<div class="farbtastic"><div class="color"></div><div class="wheel"></div><div class="overlay"></div><div class="h-marker marker"></div><div class="sl-marker marker"></div></div>');var r=t(".farbtastic",o);a.wheel=t(".wheel",o).get(0),a.radius=84,a.square=100,a.width=194,navigator.appVersion.match(/MSIE [0-6]\./)&&t("*",r).each((function(){if("none"!=this.currentStyle.backgroundImage){var o=this.currentStyle.backgroundImage;o=this.currentStyle.backgroundImage.substring(5,o.length-2),t(this).css({backgroundImage:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=crop, src='"+o+"')"})}})),a.linkTo=function(o){return"object"==typeof a.callback&&t(a.callback).off("keyup",a.updateValue),a.color=null,"function"==typeof o?a.callback=o:"object"!=typeof o&&"string"!=typeof o||(a.callback=t(o),a.callback.on("keyup",a.updateValue),a.callback.get(0).value&&a.setColor(a.callback.get(0).value)),this},a.updateValue=function(t){this.value&&this.value!=a.color&&a.setColor(this.value)},a.setColor=function(t){var o=a.unpack(t);return a.color!=t&&o&&(a.color=t,a.rgb=o,a.hsl=a.RGBToHSL(a.rgb),a.updateDisplay()),this},a.setHSL=function(t){return a.hsl=t,a.rgb=a.HSLToRGB(t),a.color=a.pack(a.rgb),a.updateDisplay(),this},a.widgetCoords=function(o){var e,r,n=o.target||o.srcElement,s=a.wheel;if(void 0!==o.offsetX){for(var i={x:o.offsetX,y:o.offsetY},c=n;c;)c.mouseX=i.x,c.mouseY=i.y,i.x+=c.offsetLeft,i.y+=c.offsetTop,c=c.offsetParent;c=s;for(var u={x:0,y:0};c;){if(void 0!==c.mouseX){e=c.mouseX-u.x,r=c.mouseY-u.y;break}u.x+=c.offsetLeft,u.y+=c.offsetTop,c=c.offsetParent}for(c=n;c;)c.mouseX=void 0,c.mouseY=void 0,c=c.offsetParent}else{i=a.absolutePosition(s);e=(o.pageX||0*(o.clientX+t("html").get(0).scrollLeft))-i.x,r=(o.pageY||0*(o.clientY+t("html").get(0).scrollTop))-i.y}return{x:e-a.width/2,y:r-a.width/2}},a.mousedown=function(o){document.dragging||(t(document).on("mousemove",a.mousemove).on("mouseup",a.mouseup),document.dragging=!0);var e=a.widgetCoords(o);return a.circleDrag=2*Math.max(Math.abs(e.x),Math.abs(e.y))>a.square,a.mousemove(o),!1},a.mousemove=function(t){var o=a.widgetCoords(t);if(a.circleDrag){var e=Math.atan2(o.x,-o.y)/6.28;e<0&&(e+=1),a.setHSL([e,a.hsl[1],a.hsl[2]])}else{var r=Math.max(0,Math.min(1,-o.x/a.square+.5)),n=Math.max(0,Math.min(1,-o.y/a.square+.5));a.setHSL([a.hsl[0],r,n])}return!1},a.mouseup=function(){t(document).off("mousemove",a.mousemove),t(document).off("mouseup",a.mouseup),document.dragging=!1},a.updateDisplay=function(){var o=6.28*a.hsl[0];t(".h-marker",r).css({left:Math.round(Math.sin(o)*a.radius+a.width/2)+"px",top:Math.round(-Math.cos(o)*a.radius+a.width/2)+"px"}),t(".sl-marker",r).css({left:Math.round(a.square*(.5-a.hsl[1])+a.width/2)+"px",top:Math.round(a.square*(.5-a.hsl[2])+a.width/2)+"px"}),t(".color",r).css("backgroundColor",a.pack(a.HSLToRGB([a.hsl[0],1,.5]))),"object"==typeof a.callback?(t(a.callback).css({backgroundColor:a.color,color:a.hsl[2]>.5?"#000":"#fff"}),t(a.callback).each((function(){this.value&&this.value!=a.color&&(this.value=a.color)}))):"function"==typeof a.callback&&a.callback.call(a,a.color)},a.absolutePosition=function(t){var o={x:t.offsetLeft,y:t.offsetTop};if(t.offsetParent){var e=a.absolutePosition(t.offsetParent);o.x+=e.x,o.y+=e.y}return o},a.pack=function(t){var o=Math.round(255*t[0]),e=Math.round(255*t[1]),a=Math.round(255*t[2]);return"#"+(o<16?"0":"")+o.toString(16)+(e<16?"0":"")+e.toString(16)+(a<16?"0":"")+a.toString(16)},a.unpack=function(t){return 7==t.length?[parseInt("0x"+t.substring(1,3))/255,parseInt("0x"+t.substring(3,5))/255,parseInt("0x"+t.substring(5,7))/255]:4==t.length?[parseInt("0x"+t.substring(1,2))/15,parseInt("0x"+t.substring(2,3))/15,parseInt("0x"+t.substring(3,4))/15]:void 0},a.HSLToRGB=function(t){var o,e,a=t[0],r=t[1],n=t[2];return o=2*n-(e=n<=.5?n*(r+1):n+r-n*r),[this.hueToRGB(o,e,a+.33333),this.hueToRGB(o,e,a),this.hueToRGB(o,e,a-.33333)]},a.hueToRGB=function(t,o,e){return 6*(e=e<0?e+1:e>1?e-1:e)<1?t+(o-t)*e*6:2*e<1?o:3*e<2?t+(o-t)*(.66666-e)*6:t},a.RGBToHSL=function(t){var o,e,a,r,n,s,i=t[0],c=t[1],u=t[2];return o=Math.min(i,Math.min(c,u)),a=(e=Math.max(i,Math.max(c,u)))-o,n=0,(s=(o+e)/2)>0&&s<1&&(n=a/(s<.5?2*s:2-2*s)),r=0,a>0&&(e==i&&e!=c&&(r+=(c-u)/a),e==c&&e!=u&&(r+=2+(u-i)/a),e==u&&e!=i&&(r+=4+(i-c)/a),r/=6),[r,n,s]},t("*",r).on("mousedown",a.mousedown),a.setColor("#000000"),e&&a.linkTo(e)}}(jQuery),function(t){var o={fade:250,position:"bottom",callback:function(o){t.log("new color="+o)}};function e(t,o,e){var a,r,n,s,i,c,u,l,f,d,h=function(t){var o=/^rgb\((.*?),(.*?),(.*?)\)/;return 7===t.length?[parseInt("0x"+t.substring(1,3))/255,parseInt("0x"+t.substring(3,5))/255,parseInt("0x"+t.substring(5,7))/255]:4===t.length?[parseInt("0x"+t.substring(1,2))/15,parseInt("0x"+t.substring(2,3))/15,parseInt("0x"+t.substring(3,4))/15]:o.test(t)?[parseFloat(t.replace(o,"$1")/255),parseFloat(t.replace(o,"$2")/255),parseFloat(t.replace(o,"$3")/255)]:t}(t);return(l=(a=h)[0],f=a[1],d=a[2],r=Math.min(l,Math.min(f,d)),s=(n=Math.max(l,Math.max(f,d)))-r,c=0,(u=(r+n)/2)>0&&u<1&&(c=s/(u<.5?2*u:2-2*u)),i=0,s>0&&(n===l&&n!==f&&(i+=(f-d)/s),n===f&&n!==d&&(i+=2+(d-l)/s),n===d&&n!==l&&(i+=4+(l-f)/s),i/=6),[i,c,u])[2]>.5?o||"#000":e||"#FFF"}function a(o,a){var r,n=a.val();function s(t){var o=e(t);a.val(t).css({"background-color":t,color:o})}return r=t.farbtastic(o).linkTo(s),n&&(s(n),r.setColor(n)),r}t((function(){var e=t("#colorpicker");0===e.length&&(e=t('<div class="ui-component-content ui-widget-content ui-hidden ui-helper-hidden" id="colorpicker"></div>').appendTo("body")),t(".jqFarbtastic:not(.jqInitedFarbtastic)").livequery((function(){var r,n=t(this),s=t.extend({},o,n.data(),n.metadata());n.addClass("jqInitedFarbtastic"),r=a(e,n),n.on("click",(function(){var t,o;function i(){var a;0===n.length&&o?window.clearInterval(o):(a=n.offset(),"left"===s.position&&(a.left+=n.outerWidth()),"bottom"===s.position&&(a.top+=n.outerHeight()),t&&t.top===a.top&&t.left===a.left||(t=a,e.css({top:a.top,left:a.left})))}r=a(e,n),i(),o=window.setInterval(i,500),e.farbtastic().fadeIn(s.fade)})).on("blur",(function(){e.farbtastic().hide(),"function"==typeof s.callback&&s.callback.call(r,r.color)}))}))})),t((function(){var o={dark:"#000",light:"#fff"};t(".jqFarbtasticFG:not(.jqInitedFarbtasticFG)").livequery((function(){var a=t(this),r=t.extend({},o,a.data()),n=e(a.css("background-color"),r.dark,r.light);a.addClass("jqInitedFarbtastic").css({color:n})}))}))}(jQuery);
